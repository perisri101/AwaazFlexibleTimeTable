<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AwaazFlexibe TimeTable</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Navigation -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="sidebar-header mb-4">
                        <h3 class="text-light text-center">AwaazFlexibleTimeTable V1</h3>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="fa-solid fa-gauge-high"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="caregivers">
                                <i class="fa-solid fa-user-nurse"></i> Caregivers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="categories">
                                <i class="fa-solid fa-tags"></i> Categories
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="activities">
                                <i class="fa-solid fa-list-check"></i> Activities
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="templates">
                                <i class="fa-solid fa-calendar-days"></i> Templates
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="calendars">
                                <i class="fa-solid fa-calendar-week"></i> Calendars
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="backups">
                                <i class="fa-solid fa-cloud-upload-alt"></i> Backups & Git
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="reports">
                                <i class="fa-solid fa-chart-pie"></i> Reports
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dynamically loaded content will be placed here -->
                <div id="content-area">
                    <!-- Dashboard (Default View) -->
                    <div id="dashboard" class="content-section active">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Dashboard</h1>
                            <button id="backup-btn" class="btn btn-warning">
                                <i class="fa-solid fa-download"></i> Backup Data
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-primary">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-user-nurse"></i> Caregivers</h5>
                                        <p class="card-text h2" id="caregiver-count">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-success">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-list-check"></i> Activities</h5>
                                        <p class="card-text h2" id="activity-count">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-info">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-calendar-days"></i> Templates</h5>
                                        <p class="card-text h2" id="template-count">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Recent Caregivers</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row" id="recent-caregivers">
                                            <!-- Recent caregivers will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Recent Activities</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Category</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recent-activities">
                                                    <!-- Recent activities will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Caregivers Section -->
                    <div id="caregivers" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Caregivers</h1>
                            <button id="add-caregiver-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Caregiver
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Picture</th>
                                        <th>Name</th>
                                        <th>Performance Score</th>
                                        <th>Hourly Rate</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="caregivers-list">
                                    <!-- Caregivers will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Categories Section -->
                    <div id="categories" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Categories</h1>
                            <button id="add-category-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Category
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categories-list">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Activities Section -->
                    <div id="activities" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Activities</h1>
                            <div>
                                <select id="filter-category" class="form-select d-inline-block me-2" style="width: auto;">
                                    <option value="">All Categories</option>
                                    <!-- Categories will be loaded here -->
                                </select>
                                <button id="add-activity-btn" class="btn btn-primary">
                                    <i class="fa-solid fa-plus"></i> Add Activity
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="activities-list">
                                    <!-- Activities will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Templates Section -->
                    <div id="templates" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Templates</h1>
                            <button id="add-template-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Template
                            </button>
                        </div>
                        <div class="row" id="templates-list">
                            <!-- Templates will be loaded here -->
                        </div>
                    </div>

                    <!-- Calendars Section -->
                    <div id="calendars" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Calendars</h1>
                            <button id="add-calendar-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Calendar
                            </button>
                        </div>
                        <div id="calendarsContainer">
                            <!-- Calendars will be loaded here -->
                        </div>
                    </div>

                    <!-- Backups and Git Section -->
                    <div id="backups" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Backups & Git</h1>
                            <div>
                                <button id="backup-data-btn" class="btn btn-primary">
                                    <i class="fa-solid fa-download"></i> Backup Data
                                </button>
                                <button id="test-git-btn" class="btn btn-info">
                                    <i class="fa-brands fa-github"></i> Test Git Connectivity
                                </button>
                                <button id="update-gitignore-btn" class="btn btn-secondary">
                                    <i class="fas fa-file-code"></i> Update .gitignore
                                </button>
                                <button id="fix-credentials-btn" class="btn btn-warning">
                                    <i class="fas fa-key"></i> Fix Git Credentials
                                </button>
                                <button id="update-repo-url-with-auth-btn" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-key"></i> Add Auth to URL
                                </button>
                                <button id="fix-rejected-push-btn" class="btn btn-warning">
                                    <i class="fas fa-code-branch"></i> Fix Rejected Push
                                </button>
                            </div>
                        </div>
                        
                        <!-- Git Test Results Section -->
                        <div id="git-test-results" class="card mb-4" style="display: none;">
                            <div class="card-header">
                                <h5>Git Connectivity Test Results</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6>Git Configuration</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <th scope="row">User Name</th>
                                                <td id="git-user-name">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">User Email</th>
                                                <td id="git-user-email">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Repository URL</th>
                                                <td id="git-repo-url">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Current Branch</th>
                                                <td id="git-branch">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">Repository Access</div>
                                            <div class="card-body">
                                                <div id="repo-access-status">Testing...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">Push Access</div>
                                            <div class="card-body">
                                                <div id="push-access-status">Testing...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6>Environment Variables</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <th scope="row">GIT_AUTO_PUSH</th>
                                                <td id="env-git-auto-push">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">ALLOW_GIT_IN_PRODUCTION</th>
                                                <td id="env-allow-git">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_USER_NAME</th>
                                                <td id="env-git-user-name">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_USER_EMAIL</th>
                                                <td id="env-git-user-email">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GITHUB_TOKEN</th>
                                                <td id="env-github-token">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_REPOSITORY_URL</th>
                                                <td id="env-git-repo-url">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <button id="run-setup-btn" class="btn btn-warning">
                                            <i class="fas fa-wrench"></i> Run Git Setup
                                        </button>
                                        <button id="toggle-troubleshooter-btn" class="btn btn-info">
                                            <i class="fas fa-tools"></i> Advanced Troubleshooting
                                        </button>
                                        <button id="toggle-env-btn" class="btn btn-secondary">
                                            <i class="fas fa-cog"></i> Environment Variables
                                        </button>
                                    </div>
                                    <div>
                                        <button id="pull-reset-btn" class="btn btn-primary">
                                            <i class="fas fa-download"></i> Pull & Reset
                                        </button>
                                        <button id="force-push-btn" class="btn btn-danger">
                                            <i class="fas fa-upload"></i> Force Push
                                        </button>
                                        <button id="force-save-btn" class="btn btn-danger">
                                            <i class="fas fa-exclamation-triangle"></i> Force Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Git Troubleshooter Section -->
                        <div id="git-troubleshooter" class="card mb-4">
                            <div class="card-header">
                                <h5>Git Connectivity Troubleshooter</h5>
                            </div>
                            <div class="card-body">
                                <p>Select an issue to fix:</p>
                                
                                <div class="list-group mb-3">
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="repo_url">
                                        <i class="fas fa-link"></i> Fix Repository URL
                                        <small class="d-block text-muted">Corrects issues with the remote repository URL</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="authentication">
                                        <i class="fas fa-key"></i> Fix Authentication
                                        <small class="d-block text-muted">Resolves GitHub token authentication problems</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="branch">
                                        <i class="fas fa-code-branch"></i> Fix Branch Issues
                                        <small class="d-block text-muted">Fixes detached HEAD and branch tracking problems</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="init">
                                        <i class="fas fa-folder-plus"></i> Fix Repository Initialization
                                        <small class="d-block text-muted">Ensures the Git repository is properly initialized</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="all">
                                        <i class="fas fa-magic"></i> Fix All Issues
                                        <small class="d-block text-muted">Attempts to fix all common Git connectivity problems</small>
                                    </button>
                                </div>
                                
                                <div id="troubleshooter-results" style="display: none;">
                                    <h6>Troubleshooting Results:</h6>
                                    <div class="alert alert-info">
                                        <div id="troubleshooter-spinner" class="spinner-border spinner-border-sm" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span id="troubleshooter-status">Working on fixes...</span>
                                    </div>
                                    
                                    <div id="actions-taken-container" style="display: none;">
                                        <h6>Actions Taken:</h6>
                                        <ul id="actions-taken-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                    
                                    <div id="errors-container" style="display: none;">
                                        <h6>Errors:</h6>
                                        <ul id="errors-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                    
                                    <div id="recommendations-container" style="display: none;">
                                        <h6>Recommendations:</h6>
                                        <ul id="recommendations-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Variables Management Section -->
                        <div id="env-variables-section" class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5>Environment Variables</h5>
                                <div>
                                    <button id="refresh-env-btn" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-sync"></i> Refresh
                                    </button>
                                    <button id="save-env-btn" class="btn btn-sm btn-primary">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                    <button id="apply-repo-url-btn" class="btn btn-sm btn-warning">
                                        <i class="fas fa-link"></i> Apply Repository URL
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <form id="env-variables-form">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="env-git-user-name" class="form-label">GIT_USER_NAME</label>
                                            <input type="text" class="form-control" id="env-git-user-name-input" name="GIT_USER_NAME">
                                            <small class="text-muted">Your Git username</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="env-git-user-email" class="form-label">GIT_USER_EMAIL</label>
                                            <input type="email" class="form-control" id="env-git-user-email-input" name="GIT_USER_EMAIL">
                                            <small class="text-muted">Your Git email address</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <label for="env-git-repo-url-input" class="form-label">GIT_REPOSITORY_URL</label>
                                            <input type="text" class="form-control" id="env-git-repo-url-input" name="GIT_REPOSITORY_URL">
                                            <small class="text-muted">URL of your Git repository (e.g., https://github.com/username/repo.git)</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="env-git-branch-input" class="form-label">GIT_BRANCH</label>
                                            <input type="text" class="form-control" id="env-git-branch-input" name="GIT_BRANCH">
                                            <small class="text-muted">Default branch (usually main or master)</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="env-github-token-input" class="form-label">GITHUB_TOKEN</label>
                                            <input type="password" class="form-control" id="env-github-token-input" name="GITHUB_TOKEN">
                                            <small class="text-muted">Your GitHub personal access token</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="env-git-auto-push-input" name="GIT_AUTO_PUSH">
                                                <label class="form-check-label" for="env-git-auto-push-input">GIT_AUTO_PUSH</label>
                                            </div>
                                            <small class="text-muted">Automatically push changes to remote repository</small>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="env-allow-git-in-production-input" name="ALLOW_GIT_IN_PRODUCTION">
                                                <label class="form-check-label" for="env-allow-git-in-production-input">ALLOW_GIT_IN_PRODUCTION</label>
                                            </div>
                                            <small class="text-muted">Allow Git operations in production environment</small>
                                        </div>
                                    </div>
                                </form>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> Changes to environment variables will be saved to the <code>.env</code> file and will persist across application restarts.
                                </div>

                                <div class="mt-3">
                                    <button id="initialize-repo-btn" class="btn btn-danger">
                                        <i class="fas fa-exclamation-triangle"></i> Initialize/Reset Git Repository
                                    </button>
                                    <small class="text-muted d-block mt-1">Use this only if you need to completely reset the Git configuration</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Git Status Panel -->
                            <div class="col-md-5 mb-4">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Git Status</h5>
                                        <button id="refresh-git-status-btn" class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-sync"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <p><strong>Current Branch:</strong> <span id="git-branch">Loading...</span></p>
                                            <p><strong>Pending Changes:</strong> <span id="git-changes-count">0</span></p>
                                        </div>
                                        <div class="table-responsive">
                                            <h6>Change Details:</h6>
                                            <ul class="list-group" id="git-changes-list">
                                                <li class="list-group-item">Loading...</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Backups Panel -->
                            <div class="col-md-7 mb-4">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Data Backups</h5>
                                        <button id="refresh-backups-btn" class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-sync"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Created At</th>
                                                        <th>Description</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="backups-list">
                                                    <tr>
                                                        <td colspan="4" class="text-center">Loading backups...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Section -->
                    <div id="reports" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Reports</h1>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Caregiver Performance</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Performance Score</th>
                                                        <th>Activities Assigned</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="caregiver-performance">
                                                    <!-- Caregiver performance will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Activities by Category</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Category</th>
                                                        <th>Activity Count</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="activities-by-category">
                                                    <!-- Activities by category will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for Caregiver Form -->
    <div class="modal fade" id="caregiverModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="caregiverModalLabel">Add Caregiver</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="caregiver-form" enctype="multipart/form-data">
                        <input type="hidden" id="caregiver-id">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="caregiver-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="caregiver-name" name="name" required>
                            </div>
                            <div class="col-md-4">
                                <label for="caregiver-initials" class="form-label">Initials</label>
                                <input type="text" class="form-control" id="caregiver-initials" name="initials" maxlength="3">
                                <small class="form-text text-muted">2-3 letters</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="caregiver-performance" class="form-label">Performance Score (1-10)</label>
                            <input type="number" class="form-control" id="caregiver-performance" name="performance_score" min="1" max="10" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Location Rates</label>
                            <div id="location-rates-container">
                                <!-- Initial location rate field -->
                                <div class="location-rate-item row mb-2">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control location-name" placeholder="Location Name" name="location_names[]">
                                    </div>
                                    <div class="col-md-5">
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control location-rate" placeholder="Rate" name="location_rates[]" min="0" step="0.01">
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-sm btn-danger remove-location"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-location-btn">
                                <i class="fas fa-plus"></i> Add Location
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <label for="caregiver-default-rate" class="form-label">Default Hourly Rate ($)</label>
                            <input type="number" class="form-control" id="caregiver-default-rate" name="default_hourly_rate" min="0" step="0.01" required>
                            <small class="form-text text-muted">Used when location-specific rate is not available</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="caregiver-picture" class="form-label">Profile Picture</label>
                            <input type="file" class="form-control" id="caregiver-picture" name="picture" accept="image/*">
                            <div id="picture-preview" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-caregiver">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Category Form -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Add Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="category-form">
                        <input type="hidden" id="category-id">
                        <div class="mb-3">
                            <label for="category-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="category-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="category-description" class="form-label">Description</label>
                            <textarea class="form-control" id="category-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-category">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Activity Form -->
    <div class="modal fade" id="activityModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="activityModalLabel">Add Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="activity-form">
                        <input type="hidden" id="activity-id">
                        <div class="mb-3">
                            <label for="activity-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="activity-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="activity-category" class="form-label">Category</label>
                            <select class="form-select" id="activity-category" required>
                                <!-- Categories will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="activity-description" class="form-label">Description</label>
                            <textarea class="form-control" id="activity-description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="activity-duration" class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-control" id="activity-duration" min="15" step="15">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-activity">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Template Form -->
    <div class="modal fade" id="templateModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templateModalLabel">Add Template</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="template-form">
                        <input type="hidden" id="template-id">
                        <div class="mb-3">
                            <label for="template-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="template-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="template-description" class="form-label">Description</label>
                            <textarea class="form-control" id="template-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-template">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Calendar Form -->
    <div class="modal fade" id="calendarModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarModalLabel">Add Calendar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="calendar-form">
                        <input type="hidden" id="calendar-id">
                        <div class="mb-3">
                            <label for="calendar-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="calendar-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-template" class="form-label">Based on Template</label>
                            <select class="form-select" id="calendar-template">
                                <option value="">None</option>
                                <!-- Templates will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-start-date" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="calendar-start-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-description" class="form-label">Description</label>
                            <textarea class="form-control" id="calendar-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-calendar">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Template Schedule Editor -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalLabel">Edit Template Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="schedule-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Monday</th>
                                    <th>Tuesday</th>
                                    <th>Wednesday</th>
                                    <th>Thursday</th>
                                    <th>Friday</th>
                                    <th>Saturday</th>
                                    <th>Sunday</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Schedule rows will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-schedule">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Block Editor -->
    <div class="modal fade" id="blockModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blockModalLabel">Edit Block</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="block-form">
                        <input type="hidden" id="block-day">
                        <input type="hidden" id="block-time">
                        <div class="mb-3">
                            <label for="block-caregivers" class="form-label">Caregivers</label>
                            <select class="form-select" id="block-caregivers" multiple size="5">
                                <option value="">Loading caregivers...</option>
                            </select>
                            <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple caregivers</small>
                        </div>
                        <div class="mb-3">
                            <label for="block-activities" class="form-label">Activities</label>
                            <select class="form-select" id="block-activities" multiple size="5">
                                <option value="">Loading activities...</option>
                            </select>
                            <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple activities</small>
                        </div>
                        <div class="mb-3">
                            <label for="block-notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="block-notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-block">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar View Modal -->
    <div class="modal fade" id="calendarViewModal" tabindex="-1" aria-labelledby="calendarViewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarViewModalLabel">Calendar View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button id="prev-week-btn" class="btn btn-outline-secondary">
                            <i class="fas fa-chevron-left"></i> Previous Week
                        </button>
                        <div class="text-center">
                            <h4 id="calendar-view-title" class="mb-1"></h4>
                            <span id="week-display" class="badge bg-info"></span>
                        </div>
                        <button id="next-week-btn" class="btn btn-outline-secondary">
                            Next Week <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="calendar-view-table" class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col" style="width: 80px;">Time</th>
                                    <th scope="col">Monday</th>
                                    <th scope="col">Tuesday</th>
                                    <th scope="col">Wednesday</th>
                                    <th scope="col">Thursday</th>
                                    <th scope="col">Friday</th>
                                    <th scope="col">Saturday</th>
                                    <th scope="col">Sunday</th>
                                </tr>
                                <tr id="calendar-dates-header">
                                    <th></th>
                                    <!-- Date headers will be dynamically added here -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Schedule rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="print-calendar-btn" class="btn btn-outline-primary">
                        <i class="fas fa-print"></i> Print Calendar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="notification-toast" class="toast align-items-center text-white bg-success" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toast-message">
                    Operation completed successfully.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/templates-calendars.js') }}"></script>
</body>
</html> 