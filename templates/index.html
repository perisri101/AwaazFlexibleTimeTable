<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AwaazFlexibe TimeTable</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <!-- Include the templates-calendars CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templates-calendars.css') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Navigation -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="sidebar-header mb-4">
                        <h3 class="text-light text-center">AwaazFlexibleTimeTable V1</h3>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="fa-solid fa-gauge-high"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="caregivers">
                                <i class="fa-solid fa-user-nurse"></i> Caregivers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="categories">
                                <i class="fa-solid fa-tags"></i> Categories
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="activities">
                                <i class="fa-solid fa-list-check"></i> Activities
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="templates">
                                <i class="fa-solid fa-calendar-days"></i> Templates
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="calendars">
                                <i class="fa-solid fa-calendar-week"></i> Calendars
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="backups">
                                <i class="fa-solid fa-cloud-upload-alt"></i> Backups & Git
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="reports">
                                <i class="fa-solid fa-chart-pie"></i> Reports
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dynamically loaded content will be placed here -->
                <div id="content-area">
                    <!-- Dashboard (Default View) -->
                    <div id="dashboard" class="content-section active">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Dashboard</h1>
                            <button id="backup-btn" class="btn btn-warning">
                                <i class="fa-solid fa-download"></i> Backup Data
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-primary">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-user-nurse"></i> Caregivers</h5>
                                        <p class="card-text h2" id="caregiver-count">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-success">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-list-check"></i> Activities</h5>
                                        <p class="card-text h2" id="activity-count">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card text-white bg-info">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="fa-solid fa-calendar-days"></i> Templates</h5>
                                        <p class="card-text h2" id="template-count">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Recent Caregivers</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row" id="recent-caregivers">
                                            <!-- Recent caregivers will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Recent Activities</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Category</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recent-activities">
                                                    <!-- Recent activities will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Caregivers Section -->
                    <div id="caregivers" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Caregivers</h1>
                            <button id="add-caregiver-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Caregiver
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Picture</th>
                                        <th>Name</th>
                                        <th>Performance Score</th>
                                        <th>Hourly Rate</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="caregivers-list">
                                    <!-- Caregivers will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Categories Section -->
                    <div id="categories" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Categories</h1>
                            <button id="add-category-btn" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Add Category
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categories-list">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Activities Section -->
                    <div id="activities" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Activities</h1>
                            <div>
                                <select id="filter-category" class="form-select d-inline-block me-2" style="width: auto;">
                                    <option value="">All Categories</option>
                                    <!-- Categories will be loaded here -->
                                </select>
                                <button id="add-activity-btn" class="btn btn-primary">
                                    <i class="fa-solid fa-plus"></i> Add Activity
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="activities-list">
                                    <!-- Activities will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Templates Section -->
                    <div id="templates" class="content-section">
                        <!-- Templates content will be loaded from templates-calendars.html -->
                    </div>

                    <!-- Calendars Section -->
                    <div id="calendars" class="content-section">
                        <!-- Calendars content will be loaded from templates-calendars.html -->
                    </div>

                    <!-- Backups and Git Section -->
                    <div id="backups" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Backups & Git</h1>
                            <div class="btn-toolbar mb-3" role="toolbar">
                                <!-- Data Management -->
                                <div class="btn-group me-2 mb-2" role="group">
                                    <button id="backup-data-btn" class="btn btn-primary">
                                        <i class="fa-solid fa-download"></i> Backup Data
                                    </button>
                                </div>
                                
                                <!-- Git Status & Testing -->
                                <div class="btn-group me-2 mb-2" role="group">
                                    <button id="test-git-btn" class="btn btn-info">
                                        <i class="fa-brands fa-github"></i> Test Connectivity
                                    </button>
                                    <button id="save-to-git-btn" class="btn btn-success">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                </div>
                                
                                <!-- Git Troubleshooting -->
                                <div class="btn-group me-2 mb-2" role="group">
                                    <div class="dropdown">
                                        <button class="btn btn-warning dropdown-toggle" type="button" id="gitFixDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fas fa-wrench"></i> Fix Git Issues
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="gitFixDropdown">
                                            <li><a class="dropdown-item" href="#" id="fix-remote-btn">
                                                <i class="fas fa-server"></i> Fix Remote Repository
                                            </a></li>
                                            <li><a class="dropdown-item" href="#" id="fix-credentials-btn">
                                                <i class="fas fa-key"></i> Fix Git Credentials
                                            </a></li>
                                            <li><a class="dropdown-item" href="#" id="update-repo-url-with-auth-btn">
                                                <i class="fas fa-key"></i> Add Auth to URL
                                            </a></li>
                                            <li><a class="dropdown-item" href="#" id="fix-rejected-push-btn">
                                                <i class="fas fa-code-branch"></i> Fix Rejected Push
                                            </a></li>
                                            <li><a class="dropdown-item" href="#" id="handle-commits-btn">
                                                <i class="fas fa-code-commit"></i> Handle Pending Commits
                                            </a></li>
                                            <li><a class="dropdown-item" href="#" id="update-gitignore-btn">
                                                <i class="fas fa-file-code"></i> Update .gitignore
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Git Test Results Section -->
                        <div id="git-test-results" class="card mb-4" style="display: none;">
                            <div class="card-header">
                                <h5>Git Connectivity Test Results</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6>Git Configuration</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <th scope="row">User Name</th>
                                                <td id="git-user-name">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">User Email</th>
                                                <td id="git-user-email">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Repository URL</th>
                                                <td id="git-repo-url">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Current Branch</th>
                                                <td id="git-branch">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">Repository Access</div>
                                            <div class="card-body">
                                                <div id="repo-access-status">Testing...</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">Push Access</div>
                                            <div class="card-body">
                                                <div id="push-access-status">Testing...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6>Environment Variables</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <th scope="row">GIT_AUTO_PUSH</th>
                                                <td id="env-git-auto-push">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">ALLOW_GIT_IN_PRODUCTION</th>
                                                <td id="env-allow-git">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_USER_NAME</th>
                                                <td id="env-git-user-name">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_USER_EMAIL</th>
                                                <td id="env-git-user-email">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GITHUB_TOKEN</th>
                                                <td id="env-github-token">Loading...</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">GIT_REPOSITORY_URL</th>
                                                <td id="env-git-repo-url">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <button id="run-setup-btn" class="btn btn-warning">
                                            <i class="fas fa-wrench"></i> Run Git Setup
                                        </button>
                                        <button id="toggle-troubleshooter-btn" class="btn btn-info">
                                            <i class="fas fa-tools"></i> Advanced Troubleshooting
                                        </button>
                                        <button id="toggle-env-btn" class="btn btn-secondary">
                                            <i class="fas fa-cog"></i> Environment Variables
                                        </button>
                                    </div>
                                    <div>
                                        <button id="pull-reset-btn" class="btn btn-primary">
                                            <i class="fas fa-download"></i> Pull & Reset
                                        </button>
                                        <button id="force-push-btn" class="btn btn-danger">
                                            <i class="fas fa-upload"></i> Force Push
                                        </button>
                                        <button id="force-save-btn" class="btn btn-danger">
                                            <i class="fas fa-exclamation-triangle"></i> Force Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Git Troubleshooter Section -->
                        <div id="git-troubleshooter" class="card mb-4">
                            <div class="card-header">
                                <h5>Git Connectivity Troubleshooter</h5>
                            </div>
                            <div class="card-body">
                                <p>Select an issue to fix:</p>
                                
                                <div class="list-group mb-3">
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="repo_url">
                                        <i class="fas fa-link"></i> Fix Repository URL
                                        <small class="d-block text-muted">Corrects issues with the remote repository URL</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="authentication">
                                        <i class="fas fa-key"></i> Fix Authentication
                                        <small class="d-block text-muted">Resolves GitHub token authentication problems</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="branch">
                                        <i class="fas fa-code-branch"></i> Fix Branch Issues
                                        <small class="d-block text-muted">Fixes detached HEAD and branch tracking problems</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="init">
                                        <i class="fas fa-folder-plus"></i> Fix Repository Initialization
                                        <small class="d-block text-muted">Ensures the Git repository is properly initialized</small>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action fix-git-issue" data-issue="all">
                                        <i class="fas fa-magic"></i> Fix All Issues
                                        <small class="d-block text-muted">Attempts to fix all common Git connectivity problems</small>
                                    </button>
                                </div>
                                
                                <div id="troubleshooter-results" style="display: none;">
                                    <h6>Troubleshooting Results:</h6>
                                    <div class="alert alert-info">
                                        <div id="troubleshooter-spinner" class="spinner-border spinner-border-sm" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span id="troubleshooter-status">Working on fixes...</span>
                                    </div>
                                    
                                    <div id="actions-taken-container" style="display: none;">
                                        <h6>Actions Taken:</h6>
                                        <ul id="actions-taken-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                    
                                    <div id="errors-container" style="display: none;">
                                        <h6>Errors:</h6>
                                        <ul id="errors-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                    
                                    <div id="recommendations-container" style="display: none;">
                                        <h6>Recommendations:</h6>
                                        <ul id="recommendations-list" class="list-group mb-3">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Variables Management Section -->
                        <div id="env-variables-section" class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5>Environment Variables</h5>
                                <div>
                                    <button id="refresh-env-btn" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-sync"></i> Refresh
                                    </button>
                                    <button id="save-env-btn" class="btn btn-sm btn-primary">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                    <button id="apply-repo-url-btn" class="btn btn-sm btn-warning">
                                        <i class="fas fa-link"></i> Apply Repository URL
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <form id="env-variables-form">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="env-git-user-name" class="form-label">GIT_USER_NAME</label>
                                            <input type="text" class="form-control" id="env-git-user-name-input" name="GIT_USER_NAME">
                                            <small class="text-muted">Your Git username</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="env-git-user-email" class="form-label">GIT_USER_EMAIL</label>
                                            <input type="email" class="form-control" id="env-git-user-email-input" name="GIT_USER_EMAIL">
                                            <small class="text-muted">Your Git email address</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <label for="env-git-repo-url-input" class="form-label">GIT_REPOSITORY_URL</label>
                                            <input type="text" class="form-control" id="env-git-repo-url-input" name="GIT_REPOSITORY_URL">
                                            <small class="text-muted">URL of your Git repository (e.g., https://github.com/username/repo.git)</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="env-git-branch-input" class="form-label">GIT_BRANCH</label>
                                            <input type="text" class="form-control" id="env-git-branch-input" name="GIT_BRANCH">
                                            <small class="text-muted">Default branch (usually main or master)</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="env-github-token-input" class="form-label">GITHUB_TOKEN</label>
                                            <input type="password" class="form-control" id="env-github-token-input" name="GITHUB_TOKEN">
                                            <small class="text-muted">Your GitHub personal access token</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="env-git-auto-push-input" name="GIT_AUTO_PUSH">
                                                <label class="form-check-label" for="env-git-auto-push-input">GIT_AUTO_PUSH</label>
                                            </div>
                                            <small class="text-muted">Automatically push changes to remote repository</small>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="env-allow-git-in-production-input" name="ALLOW_GIT_IN_PRODUCTION">
                                                <label class="form-check-label" for="env-allow-git-in-production-input">ALLOW_GIT_IN_PRODUCTION</label>
                                            </div>
                                            <small class="text-muted">Allow Git operations in production environment</small>
                                        </div>
                                    </div>
                                </form>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> Changes to environment variables will be saved to the <code>.env</code> file and will persist across application restarts.
                                </div>

                                <div class="mt-3">
                                    <button id="initialize-repo-btn" class="btn btn-danger">
                                        <i class="fas fa-exclamation-triangle"></i> Initialize/Reset Git Repository
                                    </button>
                                    <small class="text-muted d-block mt-1">Use this only if you need to completely reset the Git configuration</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Git Status Panel -->
                            <div class="col-md-5 mb-4">
                                <div class="card" id="git-status-card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Git Status</h5>
                                        <button id="refresh-git-status-btn" class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-sync"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <p><strong>Current Branch:</strong> <span id="git-branch">Loading...</span></p>
                                            <p id="git-last-commit">Loading commit info...</p>
                                            <p><strong>Pending Changes:</strong> <span id="git-changes-count">0</span></p>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <h6>Change Details:</h6>
                                            <ul class="list-group" id="git-changes-list">
                                                <li class="list-group-item">Loading...</li>
                                            </ul>
                                        </div>
                                        
                                        <div id="git-pending-commits-section" class="mb-3" style="display: none;">
                                            <h6>Pending Commits:</h6>
                                            <ul class="list-group" id="git-pending-commits-list"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Backups Panel -->
                            <div class="col-md-7 mb-4">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Data Backups</h5>
                                        <button id="refresh-backups-btn" class="btn btn-sm btn-outline-secondary">
                                            <i class="fa-solid fa-sync"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Created At</th>
                                                        <th>Description</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="backups-list">
                                                    <tr>
                                                        <td colspan="4" class="text-center">Loading backups...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Section -->
                    <div id="reports" class="content-section">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Reports</h1>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Caregiver Performance</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Performance Score</th>
                                                        <th>Activities Assigned</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="caregiver-performance">
                                                    <!-- Caregiver performance will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Activities by Category</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Category</th>
                                                        <th>Activity Count</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="activities-by-category">
                                                    <!-- Activities by category will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for Caregiver Form -->
    <div class="modal fade" id="caregiverModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="caregiverModalLabel">Add Caregiver</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="caregiver-form" enctype="multipart/form-data">
                        <input type="hidden" id="caregiver-id">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="caregiver-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="caregiver-name" name="name" required>
                            </div>
                            <div class="col-md-4">
                                <label for="caregiver-initials" class="form-label">Initials</label>
                                <input type="text" class="form-control" id="caregiver-initials" name="initials" maxlength="3">
                                <small class="form-text text-muted">2-3 letters</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="caregiver-performance" class="form-label">Performance Score (1-10)</label>
                            <input type="number" class="form-control" id="caregiver-performance" name="performance_score" min="1" max="10" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Location Rates</label>
                            <div id="location-rates-container">
                                <!-- Initial location rate field -->
                                <div class="location-rate-item row mb-2">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control location-name" placeholder="Location Name" name="location_names[]">
                                    </div>
                                    <div class="col-md-5">
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control location-rate" placeholder="Rate" name="location_rates[]" min="0" step="0.01">
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-sm btn-danger remove-location"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-location-btn">
                                <i class="fas fa-plus"></i> Add Location
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <label for="caregiver-default-rate" class="form-label">Default Hourly Rate ($)</label>
                            <input type="number" class="form-control" id="caregiver-default-rate" name="default_hourly_rate" min="0" step="0.01" required>
                            <small class="form-text text-muted">Used when location-specific rate is not available</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="caregiver-picture" class="form-label">Profile Picture</label>
                            <input type="file" class="form-control" id="caregiver-picture" name="picture" accept="image/*">
                            <div id="picture-preview" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-caregiver">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Category Form -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Add Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="category-form">
                        <input type="hidden" id="category-id">
                        <div class="mb-3">
                            <label for="category-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="category-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="category-description" class="form-label">Description</label>
                            <textarea class="form-control" id="category-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-category">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Activity Form -->
    <div class="modal fade" id="activityModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="activityModalLabel">Add Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="activity-form">
                        <input type="hidden" id="activity-id">
                        <div class="mb-3">
                            <label for="activity-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="activity-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="activity-category" class="form-label">Category</label>
                            <select class="form-select" id="activity-category" required>
                                <!-- Categories will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="activity-description" class="form-label">Description</label>
                            <textarea class="form-control" id="activity-description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="activity-duration" class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-control" id="activity-duration" min="15" step="15">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-activity">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Calendar Form -->
    <div class="modal fade" id="calendarModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarModalLabel">Add Calendar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="calendar-form">
                        <input type="hidden" id="calendar-id">
                        <div class="mb-3">
                            <label for="calendar-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="calendar-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-template" class="form-label">Based on Template</label>
                            <select class="form-select" id="calendar-template">
                                <option value="">None</option>
                                <!-- Templates will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-start-date" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="calendar-start-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="calendar-description" class="form-label">Description</label>
                            <textarea class="form-control" id="calendar-description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-calendar">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalLabel">Edit Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="schedule-template-id">
                    <div class="table-responsive">
                        <table class="table table-bordered schedule-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Monday</th>
                                    <th>Tuesday</th>
                                    <th>Wednesday</th>
                                    <th>Thursday</th>
                                    <th>Friday</th>
                                    <th>Saturday</th>
                                    <th>Sunday</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-table-body">
                                <!-- Time slots will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-schedule">Save Schedule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Block Editor -->
    <div class="modal fade" id="blockModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blockModalLabel">Edit Block</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="block-form">
                        <input type="hidden" id="block-day">
                        <input type="hidden" id="block-time">
                        <div class="mb-3">
                            <label for="block-caregivers" class="form-label">Caregivers</label>
                            <select class="form-select" id="block-caregivers" multiple size="5">
                                <option value="">Loading caregivers...</option>
                            </select>
                            <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple caregivers</small>
                        </div>
                        <div class="mb-3">
                            <label for="block-activities" class="form-label">Activities</label>
                            <select class="form-select" id="block-activities" multiple size="5">
                                <option value="">Loading activities...</option>
                            </select>
                            <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple activities</small>
                        </div>
                        <div class="mb-3">
                            <label for="block-notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="block-notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-block">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar View Modal -->
    <div class="modal fade" id="calendarViewModal" tabindex="-1" aria-labelledby="calendarViewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarViewModalLabel">Calendar View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button id="prev-week-btn" class="btn btn-outline-secondary">
                            <i class="fas fa-chevron-left"></i> Previous Week
                        </button>
                        <div class="text-center">
                            <h4 id="calendar-view-title" class="mb-1"></h4>
                            <span id="week-display" class="badge bg-info"></span>
                        </div>
                        <button id="next-week-btn" class="btn btn-outline-secondary">
                            Next Week <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="calendar-view-table" class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col" style="width: 80px;">Time</th>
                                    <th scope="col">Monday</th>
                                    <th scope="col">Tuesday</th>
                                    <th scope="col">Wednesday</th>
                                    <th scope="col">Thursday</th>
                                    <th scope="col">Friday</th>
                                    <th scope="col">Saturday</th>
                                    <th scope="col">Sunday</th>
                                </tr>
                                <tr id="calendar-dates-header">
                                    <th></th>
                                    <!-- Date headers will be dynamically added here -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Schedule rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="print-calendar-btn" class="btn btn-outline-primary">
                        <i class="fas fa-print"></i> Print Calendar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="notification-toast" class="toast align-items-center text-white bg-success" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toast-message">
                    Operation completed successfully.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Add this modal to the bottom of your HTML file -->
    <div class="modal fade" id="pendingCommitsModal" tabindex="-1" aria-labelledby="pendingCommitsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pendingCommitsModalLabel">Handle Pending Commits</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>You have commits that couldn't be pushed to the remote repository. How would you like to handle them?</p>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="commitAction" id="keepCommits" value="keep" checked>
                        <label class="form-check-label" for="keepCommits">
                            <strong>Keep commits</strong> - Keep the commits and try to push them later
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="commitAction" id="backupCommits" value="backup">
                        <label class="form-check-label" for="backupCommits">
                            <strong>Backup commits</strong> - Save commits to a backup branch and reset main branch
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="commitAction" id="discardCommits" value="discard">
                        <label class="form-check-label" for="discardCommits">
                            <strong>Discard commits</strong> - Reset to match remote repository (data loss warning!)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmHandleCommits">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Cell Modal with Bulk Selection -->
    <div class="modal fade" id="editCellModal" tabindex="-1" aria-labelledby="editCellModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCellModalLabel">Edit Schedule: <span id="cell-day-time"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Bulk Selection Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-bulk-selection">
                                <label class="form-check-label" for="enable-bulk-selection">Enable Bulk Selection</label>
                            </div>
                        </div>
                        <div class="card-body bulk-selection-options" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Days</h6>
                                    <div class="quick-select-buttons mb-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-all-days">All Days</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-weekdays">Weekdays</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-weekend">Weekend</button>
                                    </div>
                                    <div class="days-checkboxes">
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="monday" id="day-monday">
                                            <label class="form-check-label" for="day-monday">Monday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="tuesday" id="day-tuesday">
                                            <label class="form-check-label" for="day-tuesday">Tuesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="wednesday" id="day-wednesday">
                                            <label class="form-check-label" for="day-wednesday">Wednesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="thursday" id="day-thursday">
                                            <label class="form-check-label" for="day-thursday">Thursday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="friday" id="day-friday">
                                            <label class="form-check-label" for="day-friday">Friday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="saturday" id="day-saturday">
                                            <label class="form-check-label" for="day-saturday">Saturday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input day-checkbox" type="checkbox" value="sunday" id="day-sunday">
                                            <label class="form-check-label" for="day-sunday">Sunday</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Time Slots</h6>
                                    <div class="quick-select-buttons mb-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-all-times">All Times</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-morning">Morning</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-afternoon">Afternoon</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-evening">Evening</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="select-night">Night</button>
                                    </div>
                                    <div class="time-slots-checkboxes">
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="00-02" id="time-00-02">
                                            <label class="form-check-label" for="time-00-02">00-02</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="02-04" id="time-02-04">
                                            <label class="form-check-label" for="time-02-04">02-04</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="04-06" id="time-04-06">
                                            <label class="form-check-label" for="time-04-06">04-06</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="06-08" id="time-06-08">
                                            <label class="form-check-label" for="time-06-08">06-08</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="08-10" id="time-08-10">
                                            <label class="form-check-label" for="time-08-10">08-10</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="10-12" id="time-10-12">
                                            <label class="form-check-label" for="time-10-12">10-12</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="12-14" id="time-12-14">
                                            <label class="form-check-label" for="time-12-14">12-14</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="14-16" id="time-14-16">
                                            <label class="form-check-label" for="time-14-16">14-16</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="16-18" id="time-16-18">
                                            <label class="form-check-label" for="time-16-18">16-18</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="18-20" id="time-18-20">
                                            <label class="form-check-label" for="time-18-20">18-20</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="20-22" id="time-20-22">
                                            <label class="form-check-label" for="time-20-22">20-22</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input time-checkbox" type="checkbox" value="22-24" id="time-22-24">
                                            <label class="form-check-label" for="time-22-24">22-24</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="replace-existing-data">
                                    <label class="form-check-label" for="replace-existing-data">
                                        Replace existing data (if unchecked, will merge with existing data)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Rest of the modal content -->
                    <div class="row">
                        <!-- Left column: Caregivers -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Caregivers</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="caregiver-select" class="form-label">Add Caregiver</label>
                                        <div class="input-group">
                                            <select class="form-select" id="caregiver-select">
                                                <option value="">Select Caregiver</option>
                                                <!-- Caregivers will be populated here -->
                                            </select>
                                            <button class="btn btn-primary" id="add-caregiver-to-cell">Add</button>
                                        </div>
                                    </div>
                                    <div class="assigned-caregivers-container">
                                        <h6>Assigned Caregivers:</h6>
                                        <ul class="list-group" id="assigned-caregivers-list">
                                            <!-- Assigned caregivers will appear here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right column: Activities -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Activities</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="category-select" class="form-label">Filter by Category</label>
                                        <select class="form-select" id="category-select">
                                            <option value="">All Categories</option>
                                            <!-- Categories will be populated here -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="activity-select" class="form-label">Add Activity</label>
                                        <div class="input-group">
                                            <select class="form-select" id="activity-select">
                                                <option value="">Select Activity</option>
                                                <!-- Activities will be populated here -->
                                            </select>
                                            <button class="btn btn-primary" id="add-activity-to-cell">Add</button>
                                        </div>
                                    </div>
                                    <div class="assigned-activities-container">
                                        <h6>Assigned Activities:</h6>
                                        <ul class="list-group" id="assigned-activities-list">
                                            <!-- Assigned activities will appear here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-cell-changes">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/new-templates-calendars.js') }}"></script>
</body>
</html> 